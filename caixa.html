<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Caixa - FinControl</title>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
<link rel="stylesheet" href="styles.css">
<script defer src="app.js"></script>
</head>
<body>

<aside class="sidebar">
  <div class="brand">
    <div class="logo">GF</div>
    <div class="title">
      <strong>FinControl</strong>
      <span>Controle de Caixa</span>
    </div>
  </div>

  <nav class="nav">
    <a href="dashboardd.html"><span class="dot"></span>Dashboard</a>
    <a href="operadores.html"><span class="dot"></span>Operadores</a>
    <a href="clientes.html"><span class="dot"></span>Clientes</a>
    <a href="cobrancas.html"><span class="dot"></span>CobranÃ§as</a>
    <a href="emprestimos.html"><span class="dot"></span>EmprÃ©stimos</a>
    <a class="active" href="caixa.html"><span class="dot"></span>Caixa</a>
    <a href="config.html"><span class="dot"></span>ConfiguraÃ§Ãµes</a>
    <a href="login.html">âŒ Sair</a>
  </nav>

  <div class="smallnote">Somente o Gestor tem acesso a esta tela.</div>
</aside>

<div id="overlay" class="overlay"></div>

<main class="main">
  <div class="topbar">
    <div>
      <button id="menuBtn" class="btn ghost mobile-menu-btn">â˜° Menu</button>
      <h1>Controle de Caixa</h1>
      <div class="sub">Resumo financeiro do gestor</div>
    </div>
    <div class="top-right">
      <button id="themeToggle" class="theme-toggle"><span id="themeIcon">ğŸŒ™</span></button>
      <div class="user"><strong id="role"></strong><span id="name"></span><br><span id="areaText"></span></div>
    </div>
  </div>

  <div class="cards">
    <div class="card"><div class="label">ğŸ’° Valor total em caixa</div><div class="value" id="valorCaixa">R$ 0,00</div></div>
    <div class="card"><div class="label">ğŸ¦ Valor total de emprÃ©stimos</div><div class="value" id="valorEmprestimos">R$ 0,00</div></div>
    <div class="card"><div class="label">ğŸ“… Valor total a receber</div><div class="value" id="valorReceber">R$ 0,00</div></div>
  </div>

  <div class="box">
    <h2>Controle do Gestor</h2>
    <p>Somente o gestor pode liberar o caixa para os operadores.</p>
    <button id="btnLiberarCaixa" class="btn primary" style="margin-top:12px">ğŸ”“ Liberar caixa para operadores</button>
  </div>
</main>

<div class="toast" id="toast">
  <div class="t-title" id="toastTitle">Aviso</div>
  <div class="t-sub" id="toastSub"></div>
</div>

<script>
document.addEventListener("DOMContentLoaded", ()=>{
  load();
  loadTheme();
  setConfigUI();

  // Calcula totais
  const totalCaixa = state.cobrancas
    .filter(c=>c.status==="Pago")
    .reduce((s,c)=>s+(Number(c.valor)||0),0);

  const totalEmp = state.emprestimos
    .reduce((s,e)=>s+(Number(e.valor)||0),0);

  const totalReceber = state.cobrancas
    .filter(c=>c.status!=="Pago")
    .reduce((s,c)=>s+(Number(c.valor)||0),0);

  document.getElementById("valorCaixa").textContent = money(totalCaixa);
  document.getElementById("valorEmprestimos").textContent = money(totalEmp);
  document.getElementById("valorReceber").textContent = money(totalReceber);

  document.getElementById("btnLiberarCaixa").addEventListener("click", ()=>{
    toast("Caixa liberado", "Os operadores agora podem registrar movimentaÃ§Ãµes.");
  });
});
</script>

</body>
</html>
